<!-- home.page.html -->
<!-- i used ionic components from here: https://ionicframework.com/docs/components -->

<ion-header>
  <!-- gradient style is in scss, looked up toolbar theming -->
  <ion-toolbar color="primary" class="toolbar-gradient">
    <ion-title>Mental Wellness Journal</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- prompt button with tiny loading state -->
  <!-- i copied ion-spinner usage from ionic docs -->
  <ion-button expand="block" color="secondary" (click)="getPrompt()" [disabled]="loading">
    <ion-spinner *ngIf="loading" name="dots" style="margin-right:8px;"></ion-spinner>
    <span *ngIf="!loading">ðŸŽ² New Wellness Prompt</span>
    <span *ngIf="loading">Loadingâ€¦</span>
  </ion-button>

  <!-- show prompt + author in a card -->
  <ion-card *ngIf="prompt" class="elev">
    <ion-card-header>
      <ion-card-title>Prompt</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p class="prompt-text">{{ prompt }}</p>
      <p *ngIf="promptAuthor" class="prompt-author">â€” {{ promptAuthor }}</p>
    </ion-card-content>
  </ion-card>

  <!-- journal textarea -->
  <ion-item lines="full" class="mt elev">
    <!-- auto-grow was from examples i saw -->
    <ion-textarea
      auto-grow="true"
      placeholder="Write your reflectionâ€¦"
      [(ngModel)]="noteText">
    </ion-textarea>
  </ion-item>

  <!-- save button -->
  <ion-button expand="block" color="success" (click)="saveNote()">ðŸ’¾ Save Reflection</ion-button>

  <!-- reminder card (local notifications) -->
  <!-- i followed capacitor local notifications guide for logic -->
  <ion-card class="mt elev">
    <ion-card-header>
      <ion-card-title>Daily Reminder</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label>Enable daily notification</ion-label>
        <ion-toggle [(ngModel)]="reminderEnabled" (ionChange)="toggleReminder()"></ion-toggle>
      </ion-item>

      <ion-item>
        <ion-label>Reminder time</ion-label>
        <ion-input type="time" [(ngModel)]="reminderTime" (ionChange)="reminderEnabled && scheduleDailyReminder()"></ion-input>
      </ion-item>

      <ion-button expand="block" fill="outline" (click)="testNotificationNow()">ðŸ”” Test Notification (5s)</ion-button>
    </ion-card-content>
  </ion-card>

  <!-- saved notes with swipe delete -->
  <!-- pattern copied from: https://ionicframework.com/docs/api/item-sliding -->
  <ion-list *ngIf="notes.length" class="mt elev">
    <ion-list-header>Recent Reflections (swipe left to delete)</ion-list-header>

    <ion-item-sliding *ngFor="let n of notes">
      <ion-item>
        <ion-label>
          <h2 class="note-date">{{ n.date }}</h2>
          <p class="note-line"><strong>Prompt:</strong> {{ n.prompt }} <span *ngIf="n.author" class="muted">â€” {{ n.author }}</span></p>
          <p><strong>Your reflection:</strong> {{ n.text }}</p>
        </ion-label>
      </ion-item>
      <ion-item-options side="end">
        <ion-item-option color="danger" (click)="deleteNote(n.id)">ðŸ—‘ Delete</ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

</ion-content>
